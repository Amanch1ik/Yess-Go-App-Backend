# üó∫Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞ OpenStreetMap

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OSRM (Open Source Routing Machine)
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å `app/services/osrm_service.py`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ OpenStreetMap –¥–ª—è —Ç–æ—á–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–∏, –ø–µ—à–∫–æ–º, –≤–µ–ª–æ—Å–∏–ø–µ–¥
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∏ –±—ã—Å—Ç—Ä—ã–π

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è GraphHopper
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å `app/services/graphhopper_service.py`
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —Å –ø–µ—Ä–µ—Å–∞–¥–∫–∞–º–∏
- ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤

### 3. –û–±–Ω–æ–≤–ª–µ–Ω RouteService
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: OSRM ‚Üí GraphHopper ‚Üí Google Maps ‚Üí Mapbox
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

### 4. –ù–æ–≤—ã–µ API endpoints
- ‚úÖ `POST /api/v1/routes/detailed` - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
- ‚úÖ `POST /api/v1/routes/transit` - –º–∞—Ä—à—Ä—É—Ç—ã –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ
- ‚úÖ –£–ª—É—á—à–µ–Ω `GET /api/v1/partners/locations` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞–¥–∏—É—Å—É

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç

```bash
POST /api/v1/routes/calculate
{
  "partner_location_ids": [1, 2, 3],
  "transport_mode": "DRIVING",
  "optimize_route": true
}
```

### –î–µ—Ç–∞–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç —Å –≥–µ–æ–º–µ—Ç—Ä–∏–µ–π

```bash
POST /api/v1/routes/detailed
{
  "partner_location_ids": [1, 2],
  "transport_mode": "DRIVING"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "total_distance": "5.23 km",
  "estimated_time": "12 min",
  "distance_meters": 5230,
  "duration_seconds": 720,
  "geometry": {
    "type": "LineString",
    "coordinates": [[...]]
  },
  "steps": [...],
  "route_points": [...]
}
```

### –ú–∞—Ä—à—Ä—É—Ç –Ω–∞ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ

```bash
POST /api/v1/routes/transit
{
  "partner_location_ids": [1, 2],
  "transport_mode": "TRANSIT"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "total_distance": "8.5 km",
  "estimated_time": "25 min",
  "transport_type": "bus",
  "alternatives": [
    {
      "transport_type": "trolleybus",
      "distance": "8.7 km",
      "time": "28 min"
    }
  ],
  "instructions": [
    {
      "text": "–ò–¥–∏—Ç–µ –∫ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ",
      "distance": 200,
      "time": 3
    }
  ]
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ

```bash
GET /api/v1/partners/locations?latitude=42.8746&longitude=74.5698&radius=5.0
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### env.example

```bash
# OpenStreetMap Routing (OSRM) - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
OSRM_URL=http://router.project-osrm.org
OSRM_ENABLED=True

# GraphHopper - –î–ª—è –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
GRAPHHOPPER_URL=https://graphhopper.com/api/1
GRAPHHOPPER_API_KEY=CHANGE_ME_GRAPHHOPPER_API_KEY
GRAPHHOPPER_ENABLED=True
```

### –ü—É–±–ª–∏—á–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã

**OSRM:**
- –ü—É–±–ª–∏—á–Ω—ã–π: `http://router.project-osrm.org`
- –î–ª—è –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∏–ª–∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–≤–æ–π

**GraphHopper:**
- –ü—É–±–ª–∏—á–Ω—ã–π: `https://graphhopper.com/api/1`
- –¢—Ä–µ–±—É–µ—Ç API –∫–ª—é—á (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–æ—Å—Ç—É–ø–µ–Ω)

## üîß –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ OSRM —Å–µ—Ä–≤–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–≤–æ–π OSRM —Å–µ—Ä–≤–µ—Ä:

```bash
# Docker
docker run -t -i -p 5000:5000 \
  -v "${PWD}:/data" osrm/osrm-backend \
  osrm-routed --algorithm mld /data/kyrgyzstan-latest.osrm
```

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **OSRM**: ~100-200ms –Ω–∞ –∑–∞–ø—Ä–æ—Å
- **GraphHopper**: ~200-500ms –Ω–∞ –∑–∞–ø—Ä–æ—Å
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–¢–æ—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ OpenStreetMap
2. **–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ–±—É—Å–æ–≤, —Ç—Ä–æ–ª–ª–µ–π–±—É—Å–æ–≤, –º–∞—Ä—à—Ä—É—Ç–æ–∫
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä—è–¥–∫–∞ –ø–æ—Å–µ—â–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
4. **Fallback**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
5. **GeoJSON**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–µ–æ–º–µ—Ç—Ä–∏—é –º–∞—Ä—à—Ä—É—Ç–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- OSRM —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ API –∫–ª—é—á–∞ (–ø—É–±–ª–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
- GraphHopper —Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á –¥–ª—è –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- –î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–≤–æ–π OSRM —Å–µ—Ä–≤–µ—Ä
- –í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

