# üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

–°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ FastAPI –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –∏ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

- ‚úÖ JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç JSON —Å –ø–æ–ª—è–º–∏: phone_number, password, first_name, last_name
- ‚úÖ –í—Ö–æ–¥ —á–µ—Ä–µ–∑ OAuth2PasswordRequestForm (username = phone_number)
- ‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç `/auth/me` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –¢–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ SECRET_KEY –∏ ALGORITHM –∏–∑ config
- ‚úÖ get_current_user –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç JWT –∏–∑ Authorization: Bearer <token>

## üìã –®–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### 1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `env.example` –≤ `.env`:

```bash
cd E:\Yess-Go-App-Backend\Yess-Money---app-master\yess-backend
copy env.example .env
```

–û—Ç–∫—Ä–æ–π—Ç–µ `.env` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–∞–∫ –º–∏–Ω–∏–º—É–º:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://yess_user:secure_password@localhost/yess_db

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏–∑–º–µ–Ω–∏—Ç–µ!)
SECRET_KEY=your_super_secret_key_here_minimum_32_characters_long
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
ENVIRONMENT=development
DEBUG=True
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- fastapi
- uvicorn
- sqlalchemy
- psycopg2-binary
- python-jose[cryptography]
- passlib[bcrypt]
- python-multipart
- alembic

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL

#### –í–∞—Ä–∏–∞–Ω—Ç A: –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL

```bash
# –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
psql -U postgres
CREATE DATABASE yess_db;
CREATE USER yess_user WITH PASSWORD 'secure_password';
GRANT ALL PRIVILEGES ON DATABASE yess_db TO yess_user;
\q
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: Docker PostgreSQL

```bash
docker run --name yess-postgres \
  -e POSTGRES_USER=yess_user \
  -e POSTGRES_PASSWORD=secure_password \
  -e POSTGRES_DB=yess_db \
  -p 5432:5432 \
  -d postgres:15
```

### 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd E:\Yess-Go-App-Backend\Yess-Money---app-master\yess-backend
alembic upgrade head
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã, –≤–∫–ª—é—á–∞—è –ø–æ–ª—è `first_name` –∏ `last_name` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`.

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

```bash
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

–ò–ª–∏ —á–µ—Ä–µ–∑ PowerShell —Å–∫—Ä–∏–ø—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å):
```powershell
.\start_dev.ps1
```

### 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: **http://localhost:8000/docs**

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å Swagger UI —Å —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏:
- `POST /api/v1/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/v1/auth/login` - –í—Ö–æ–¥
- `GET /api/v1/auth/me` - –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Swagger UI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/docs
2. –ù–∞–π–¥–∏—Ç–µ `POST /api/v1/auth/register`
3. –ù–∞–∂–º–∏—Ç–µ "Try it out"
4. –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ:
```json
{
  "phone_number": "+996555123456",
  "password": "test123",
  "first_name": "–ò–≤–∞–Ω",
  "last_name": "–ò–≤–∞–Ω–æ–≤"
}
```
5. –ù–∞–∂–º–∏—Ç–µ "Execute"
6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
7. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Authorize" –≤–≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
8. –í–≤–µ–¥–∏—Ç–µ: `Bearer <–≤–∞—à_—Ç–æ–∫–µ–Ω>`
9. –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ `GET /api/v1/auth/me`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
python test_auth_api.py
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í—ã–ø–æ–ª–Ω–∏—Ç –≤—Ö–æ–¥
- –ü–æ–ª—É—á–∏—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

### –í–∞—Ä–∏–∞–Ω—Ç 3: cURL –∫–æ–º–∞–Ω–¥—ã

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:
```bash
curl -X POST "http://localhost:8000/api/v1/auth/register" \
  -H "Content-Type: application/json" \
  -d "{\"phone_number\":\"+996555123456\",\"password\":\"test123\",\"first_name\":\"–ò–≤–∞–Ω\",\"last_name\":\"–ò–≤–∞–Ω–æ–≤\"}"
```

#### –í—Ö–æ–¥:
```bash
curl -X POST "http://localhost:8000/api/v1/auth/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=%2B996555123456&password=test123"
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```bash
curl -X GET "http://localhost:8000/api/v1/auth/me" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

–í–æ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã/—Å–æ–∑–¥–∞–Ω—ã:

1. **–°–æ–∑–¥–∞–Ω:** `app/services/dependencies.py` - —Ñ—É–Ω–∫—Ü–∏—è `get_current_user` –¥–ª—è JWT
2. **–û–±–Ω–æ–≤–ª–µ–Ω:** `app/services/auth_service.py` - —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –≤—Ö–æ–¥–∞
3. **–û–±–Ω–æ–≤–ª–µ–Ω:** `app/models/user.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `first_name`, `last_name`
4. **–û–±–Ω–æ–≤–ª–µ–Ω:** `app/schemas/user.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
5. **–û–±–Ω–æ–≤–ª–µ–Ω:** `app/api/v1/auth.py` - —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
6. **–û–±–Ω–æ–≤–ª–µ–Ω:** `app/api/v1/api_router.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π prefix
7. **–°–æ–∑–¥–∞–Ω:** `alembic/versions/2025_11_05_0000-add_first_last_name.py` - –º–∏–≥—Ä–∞—Ü–∏—è –ë–î

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "No module named 'app'"

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
```bash
cd E:\Yess-Go-App-Backend\Yess-Money---app-master\yess-backend
```

### –û—à–∏–±–∫–∞: "Could not connect to database"

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. PostgreSQL –∑–∞–ø—É—â–µ–Ω
2. DATABASE_URL –≤ `.env` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `yess_db` —Å–æ–∑–¥–∞–Ω–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
psql -U yess_user -d yess_db -h localhost
```

### –û—à–∏–±–∫–∞: "SECRET_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `SECRET_KEY`:
```env
SECRET_KEY=your_super_secret_key_here_minimum_32_characters
```

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏: "relation already exists"

–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç:
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
alembic current

# –ü–æ–º–µ—Ç–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –±–µ–∑ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
alembic stamp head
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** —Å–º. `AUTH_SETUP.md`
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** http://localhost:8000/docs
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** http://localhost:8000/redoc

## ‚ú® –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—ã –º–æ–∂–µ—Ç–µ:

1. –î–æ–±–∞–≤–∏—Ç—å refresh tokens –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–µ—Å—Å–∏–π
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ SMS
3. –î–æ–±–∞–≤–∏—Ç—å email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
5. –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –≤—Ö–æ–¥—ã (Google, Facebook –∏ —Ç.–¥.)

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL –∏ SECRET_KEY –≤ .env
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ AUTH_SETUP.md –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

